%YAML 1.2
---

Daemon:n
  user: newrelic
  pidfile: /var/run/newrelic/newrelic-plugin-agent.pid

Logging:
  formatters:
    verbose:
      format: '%(levelname) -10s %(asctime)s %(process)-6d %(processName) -15s %(threadName)-10s %(name) -45s %(funcName) -25s L%(lineno)-6d: %(message)s'
  handlers:
    file:
      class : logging.handlers.RotatingFileHandler
      formatter: verbose
      filename: /var/log/newrelic/newrelic-plugin-agent.log
      maxBytes: 10485760
      backupCount: 3
  loggers:
    newrelic_plugin_agent:
      level: INFO
      propagate: True
      handlers: [console, file]
    requests:
      level: ERROR
      propagate: True
      handlers: [console, file]

Application:
  license_key: <%= node[:new_relic][:license_key] %>
  wake_interval: 60
  #newrelic_api_timeout: 10
  #proxy: http://localhost:8080

<% if @apache_httpd && @apache_httpd.size>0 %>
  apache_httpd:
<%  @apache_httpd.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #apache_httpd:
  #  name: hostname
  #  scheme: http
  #  host: localhost
  #  verify_ssl_cert: true
  #  port: 80
  #  path: /server-status
<% end %>

<% if @couchdb && @couchdb.size>0 %>
  couchdb:
<%  @couchdb.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #couchdb:
  #  name: localhost
  #  host: localhost
  #  verify_ssl_cert: true
  #  port: 5984
  #  username: foo
  #  password: bar
<% end %>

<% if @elasticsearch && @elasticsearch.size>0 %>
  elasticsearch:
<%  @elasticsearch.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #elasticsearch:
  #  name: Clustername
  #  host: localhost
  #  port: 9200
  #  scheme: http
<% end %>

<% if @haproxy && @haproxy.size>0 %>
  haproxy:
<%  @haproxy.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #haproxy:
  #  name: hostname
  #  scheme: http
  #  host: localhost
  #  port: 80
  #  verify_ssl_cert: true
  #  path: /haproxy?stats;csv
<% end %>

<% if @memcached && @memcached.size>0 %>
  memcached:
<%  @memcached.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #memcached:
  #  name: localhost
  #  host: localhost
  #  port: 11211
  #  path: /path/to/unix/socket
<% end %>

<% if @mongodb && @mongodb.size>0 %>
  mongodb:
<%  @mongodb.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #mongodb:
  #  name: hostname
  #  host: localhost
  #  port: 27017
  #  admin_username: user
  #  admin_password: pass
  #  ssl: False
  #  ssl_keyfile: /path/to/keyfile
  #  ssl_certfile: /path/to/certfile
  #  ssl_cert_reqs: 0  # Should be 0 for ssl.CERT_NONE, 1 for ssl.CERT_OPTIONAL, 2 for ssl.CERT_REQUIRED
  #  ssl_ca_certs: /path/to/cacerts file
  #  databases:
  #    - test
  #    - yourdbname

  #mongodb:  # Use when authentication is required (NOT SUPPORTED IN THIS CHEF RECIPE)
  #  name: hostname
  #  host: localhost
  #  port: 27017
  #  admin_username: user
  #  admin_password: pass
  #  ssl: False
  #  ssl_keyfile: /path/to/keyfile
  #  ssl_certfile: /path/to/certfile
  #  ssl_cert_reqs: 0  # Should be 0 for ssl.CERT_NONE, 1 for ssl.CERT_OPTIONAL, 2 for ssl.CERT_REQUIRED
  #  ssl_ca_certs: /path/to/cacerts file
  #  databases:
  #    test:
  #      username: user
  #      password: pass
  #    yourdbname:
  #      username: user
  #      password: pass
<% end %>

<% if @nginx && @nginx.size>0 %>
  nginx:
<%  @nginx.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #nginx:
  #  name: hostname
  #  scheme: http
  #  host: localhost
  #  port: 80
  #  verify_ssl_cert: true
  #  path: /nginx_stub_status
<% end %>

<% if @pgbouncer && @pgbouncer.size>0 %>
  pgbouncer:
<%  @pgbouncer.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #pgbouncer:
  #  host: localhost
  #  port: 6000
  #  user: stats
<% end %>

<% if @php_apc && @php_apc.size>0 %>
  php_apc:
<%  @php_apc.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #php_apc:
  #  name: hostname
  #  scheme: http
  #  host: localhost
  #  verify_ssl_cert: true
  #  port: 80
  #  path: /apc-nrp.php
<% end %>

<% if @php_fpm && @php_fpm.size>0 %>
  php_fpm:
<%  @php_fpm.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #php_fpm:
  #  - name: fpm-pool
  #    scheme: https
  #    host: localhost
  #    port: 443
  #    path: /fpm_status
  #    query: json
<% end %>

<% if @postgresql && @postgresql.size>0 %>
  postgresql:
<%  @postgresql.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #postgresql:
  #  host: localhost
  #  port: 5432
  #  user: postgres
  #  dbname: postgres
  #  superuser: False
<% end %>

<% if @rabbitmq && @rabbitmq.size>0 %>
  rabbitmq:
<%  @rabbitmq.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #rabbitmq:
  #  name: rabbitmq@localhost
  #  host: localhost
  #  port: 15672
  #  verify_ssl_cert: true
  #  username: guest
  #  password: guest
  #  vhosts: # [OPTIONAL, track this vhosts' queues only]
  #    production_vhost:
  #      queues: [encode_video, ] # [OPTIONAL, track this queues only]
  #    staging_vhost: # [track every queue for this vhost]
  #
<% end %>

<% if @redis && @redis.size>0 %>
  redis:
<%  @redis.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #redis:
  #  - name: localhost
  #    host: localhost
  #    port: 6379
  #    db_count: 16
  #    password: foo # [OPTIONAL]
  #    #path: /var/run/redis/redis.sock
  #  - name: localhost
  #    host: localhost
  #    port: 6380
  #    db_count: 16
  #    password: foo # [OPTIONAL]
  #    #path: /var/run/redis/redis.sock
<% end %>

<% if @riak && @riak.size>0 %>
  riak:
<%  @riak.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #riak:
  #  name: localhost
  #  host: node0.riak0.scs.mtmeprod.net
  #  verify_ssl_cert: true
  #  port: 8098
<% end %>

<% if @uwsgi && @uwsgi.size>0 %>
  uwsgi:
<%  @uwsgi.each do |opt_name, opt_value| %>
    <%= opt_name %>: <%= opt_value %>     
<%  end
   else %>
  #uwsgi:
  #  name: localhost
  #  host: localhost
  #  port: 1717
  #  path: /path/to/unix/socket
<% end %>
